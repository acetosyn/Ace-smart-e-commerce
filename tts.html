<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TTS Demo</title>
</head>
<body>
  <h1>TTS Demo</h1>
  <button onclick="initTTS('Hi there, I am your smart assistant.')">Test Voice</button>

  <script>
    function logAvailableVoices() {
      const voices = window.speechSynthesis.getVoices();
      console.log("Available voices:");
      voices.forEach((voice, index) => {
        console.log(`${index + 1}. Name: ${voice.name}, Lang: ${voice.lang}, Gender guess: ${voice.name.toLowerCase().includes('female') ? 'Female' : 'Unknown'}`);
      });
    }

    function getBestVoice() {
      const voices = window.speechSynthesis.getVoices();

      // Try to get a known high-quality voice (Edge on Windows has Microsoft voices)
      const preferredVoices = [
        'Microsoft Aria Online',
        'Microsoft Jenny Online',
        'Microsoft Zira Desktop',
        'Google UK English Female',
        'Google US English'
      ];

      const matchedPreferred = voices.find(v =>
        preferredVoices.some(name => v.name.includes(name))
      );

      const fallbackFemale = voices.find(v =>
        v.lang.startsWith('en') && v.name.toLowerCase().includes('female')
      );

      return matchedPreferred || fallbackFemale || voices[0];
    }

    function speakText(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = getBestVoice();
      utterance.pitch = 1;
      utterance.rate = 1;
      console.log("Using voice:", utterance.voice.name);
      window.speechSynthesis.speak(utterance);
    }

    function initTTS(text) {
      const synth = window.speechSynthesis;

      // Use a timeout to wait for voices to load
      const tryLoad = () => {
        const voices = synth.getVoices();
        if (voices.length > 0) {
          logAvailableVoices();
          speakText(text);
        } else {
          console.log("Voices not loaded yet, retrying...");
          setTimeout(tryLoad, 200);
        }
      };

      tryLoad();
    }
  </script>
</body>
</html>
